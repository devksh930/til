# 연관관계 매핑 기초
- 방향(Direction)
    - 단방향 : 회원 -> 팀 또는 팀-> 회원 둘중 한쪽만 참조 하는 관계
    - 양방향 : 회원 -> 팀 , 팀 -> 회원 양쪽 모두 참조하는 관계
- 다중성(Muiltipilcity) : N:1, 1:N, 1:1, N:N 다중성이 있다. 회원은 팀에 속하므로 회원과 팀은 N:1 팀과 회원은 1:N 관계가 된다
- 연관관계의 주인(Owner) : 객체를 양방향 관계로 만들면 연관관계의 주인을 정해야 한다.

#### 단방향 연관관계
 - N:1 관계
     - 회원과 팀이 있다
     - 회원은 하나의 팀에만 소속될 수 있다.
     - 회원과 팀은 다대일 관계이다
 ![다대일연관관계](https://user-images.githubusercontent.com/45715241/93057730-57bafe80-f6a9-11ea-8381-d858fd53f5b4.jpeg)
- 객체 연관관계
    - 회원 객체는 Member.team 필드로 팀 객체와 연관관계를 맺는다
    - 회원객체와 팀객체는 단방향 관계이다 member->team으로 탐색이 가능하지만 team-> member는 탐색이 불가능하다.
- 테이블 연관관계
    - 회원테이블은 TEAM_ID 외래 키로 팀테이블과 연관관계를 맺는다.
    - 회원 테이블과 팀테이블은 양방향 관계이다.

- 객체와 테이블의 연관관계 차이
    - 객체간의 연관관계를 하나더 만들어야 한다 양쪽에서 서로 참조하는 것을 양방향 연관관계라 한다. 실질적으로는 다른 서로 다른 단방향 연관관계 이다.
    - 반면 테이블은 외래키 하나로 양방향으로 조인이 가능하다.
 
 - 단방향 연관관계
 <pre>
 <code> class A{
    B b;
   }
 class B{}</code>
 </pre>
 - 양방향 연관관계
 <pre>
 <code> class A{
    B b;
  }
 class B{
    A a;
  }</code>
 </pre>
### 조회
연관관계 엔티티를 조회하는 방법은 크게 2가지이다.
- 객체 그래프 탐색(객체 연관관계를 사용한 조회)
- 객체지향 쿼리 사용 (JPQL)

- 객체 그래프 탐색
    - member.getTeam()을 사용해서 member와 연관된 team 엔티티를 조회할수 있다.
    <pre>
    <code>Member member = em.find(Member.Class,"member1");
    Team team = member.getTeam();//객체 그래프탐색
    System.out.println("팀이름"+ team.getName);</code></pre>
    객체를 통해 연관된 데이터를 조회하는것을 객체 그래프 탐색이라고 한다.
- 객체지향 쿼리 사용
    - 회은을 대상으로 팀1에 소속된 회원을 조회
### 수정
- 단순히 불러온 엔티티의 값만 변경해두면 트랜잭션을 커밋할 때 플러시가 일어나면서 변경감지기능이 작동한다. 변경사항은 데이터베이스에 자동으로 반영한다. 연관관계 수정시에도 참조하는 대상만 변경하면 나머지는 jpa가 알아서 자동으로 처리한다.
### 연관관계 제거
- 연관관계제거도 수정과 똑같다. 참조하는 대상만 제거하면 연관관계가 제거된다.
- 연관된 엔티티를 삭제할 경우에도 기존에 있던 연관관계를 먼저 제거하고 삭제해야 한다. 그렇지 않으면 외래키 제약조건으로 인해 데이터베이스에서 오류가 발생한다.

### 양방향 연관관계
- 일대다 관계는 여러 건과 연관관계를 맺을수 있으므로 컬렉션(Collection,Set,Map)을 사용해야한다.
- 양방향 연관관계면 member 와 team은 N:1관계이고 team과 member는 1:N 관계이다.

### 연관관계 주인
@OneToMany 에서 mappedBy라는 속성이 왜 필요할까?
- 객체에는 양방향 연관관계라는것이 존재하지 않는다. 서로 다른 단방향 연관관계 2개를 애플리케이션 로직으로 잘 묶어서 양방향 인것처럼 보이게 할뿐이다.
- 반면 데이터베이스 테이블은 외래키 하나로 양쪽이 서로 조인이 가능하다.

객체에서의 연관관계
- 회원 -> 팀 연관관계 1개 (단방향)
- 팀 -> 회원 연관관계 1개 (단방향)

테이블 연관관계
- 회원 <--> 팀의 연관관계 (양방향)